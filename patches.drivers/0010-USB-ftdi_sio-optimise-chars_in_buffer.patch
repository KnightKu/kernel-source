From 28d430d35a5c81abb87674f019792619f02ec6b4 Mon Sep 17 00:00:00 2001
From: Johan Hovold <jhovold@gmail.com>
Date: Mon, 29 Oct 2012 10:56:27 +0100
Subject: [PATCH 10/12] USB: ftdi_sio: optimise chars_in_buffer
References: bnc#956375
Git-Commit: 8da636d9b5f3af354458f5b7eadaf51f23017fdc
Patch-Mainline: v3.8

No need to check hardware buffers when we know that the software
buffers are non-empty.

Signed-off-by: Johan Hovold <jhovold@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Oliver Neukum <oneukum@suse.com>
---
 drivers/usb/serial/ftdi_sio.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/usb/serial/ftdi_sio.c b/drivers/usb/serial/ftdi_sio.c
index d179bc0..fca3698 100644
--- a/drivers/usb/serial/ftdi_sio.c
+++ b/drivers/usb/serial/ftdi_sio.c
@@ -2171,6 +2171,8 @@ static int ftdi_chars_in_buffer(struct tty_struct *tty)
 	int ret;
 
 	chars = usb_serial_generic_chars_in_buffer(tty);
+	if (chars)
+		return chars;
 
 	/* Check hardware buffer */
 	switch (priv->chip_type) {
-- 
2.1.4

