From: Wei Yongjun <weiyj.lk@gmail.com>
Date: Sat, 6 Aug 2016 01:01:24 +0000
Subject: IB/hns: Fix return value check in hns_roce_get_cfg()
Git-commit: 204f69ba64122b1ee6732bab8cfd71fe2d68c188
Patch-mainline: v4.9-rc1
References: fate#322061

In case of error, the function devm_ioremap_resource() returns ERR_PTR()
and never returns NULL. The NULL test in the return value check should
be replaced with IS_ERR().

Signed-off-by: Wei Yongjun <weiyj.lk@gmail.com>
Signed-off-by: Doug Ledford <dledford@redhat.com>
Signed-off-by: Matthias Brugger <mbrugger@suse.com>
---
 drivers/infiniband/hw/hns/hns_roce_main.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/infiniband/hw/hns/hns_roce_main.c b/drivers/infiniband/hw/hns/hns_roce_main.c
index 5b42ec8..6ead671 100644
--- a/drivers/infiniband/hw/hns/hns_roce_main.c
+++ b/drivers/infiniband/hw/hns/hns_roce_main.c
@@ -715,8 +715,8 @@ static int hns_roce_get_cfg(struct hns_roce_dev *hr_dev)
 
 	res = platform_get_resource(hr_dev->pdev, IORESOURCE_MEM, 0);
 	hr_dev->reg_base = devm_ioremap_resource(dev, res);
-	if (!hr_dev->reg_base)
-		return -ENOMEM;
+	if (IS_ERR(hr_dev->reg_base))
+		return PTR_ERR(hr_dev->reg_base);
 
 	for (i = 0; i < HNS_ROCE_MAX_PORTS; i++) {
 		net_node = of_parse_phandle(np, "eth-handle", i);
-- 
2.6.6

