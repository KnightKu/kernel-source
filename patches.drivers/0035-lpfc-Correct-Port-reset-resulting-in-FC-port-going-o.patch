From 634df8636d336147fc04e79ce65430623cf2bdcd Mon Sep 17 00:00:00 2001
From: James Smart <james.smart@broadcom.com>
Date: Wed, 6 Jul 2016 12:36:06 -0700
Subject: lpfc: Correct Port reset resulting in FC port going offline
References: FATE#321664, bsc#1017969
Git-commit: 0e916ee71d2f0453dbfe402cd8ca24f9668518ad
Patch-mainline: v4.8-rc1

Correct Port reset resulting in FC port going offline

Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
Signed-off-by: James Smart <james.smart@broadcom.com>
Reviewed-by: Hannes Reinecke <hare@suse.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Johannes Thumshirn <jthumshirn@suse.de>

---
 drivers/scsi/lpfc/lpfc_init.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/scsi/lpfc/lpfc_init.c b/drivers/scsi/lpfc/lpfc_init.c
index cd43ddf..8c2e55e4 100644
--- a/drivers/scsi/lpfc/lpfc_init.c
+++ b/drivers/scsi/lpfc/lpfc_init.c
@@ -1595,9 +1595,10 @@ lpfc_sli4_port_sta_fn_reset(struct lpfc_hba *phba, int mbx_action,
 		 * ready before performing reset.
 		 */
 		rc = lpfc_sli4_pdev_status_reg_wait(phba);
-		if (!rc)
+		if (rc)
 			return rc;
 	}
+
 	/* need reset: attempt for port recovery */
 	if (en_rn_msg)
 		lpfc_printf_log(phba, KERN_ERR, LOG_INIT,
-- 
1.8.5.6

