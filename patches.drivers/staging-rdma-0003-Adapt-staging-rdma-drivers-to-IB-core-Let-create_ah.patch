From: Thomas Bogendoerfer <tbogendoerfer@suse.de>
Date: Tue, 11 Apr 2017 13:42:47 +0200
Subject: Adpat staging/rdma drivers to IB/core: Let create_ah return extended
 response to user
References: bsc#1030230
Patch-mainline: Never, fixes build bugs in upstream removed Linux drivers

Signed-off-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/staging/rdma/ehca/ehca_av.c      | 3 ++-
 drivers/staging/rdma/ehca/ehca_iverbs.h  | 3 ++-
 drivers/staging/rdma/ipath/ipath_verbs.c | 3 ++-
 3 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/rdma/ehca/ehca_av.c b/drivers/staging/rdma/ehca/ehca_av.c
index 465926319f3d..87effc217373 100644
--- a/drivers/staging/rdma/ehca/ehca_av.c
+++ b/drivers/staging/rdma/ehca/ehca_av.c
@@ -85,7 +85,8 @@ int ehca_calc_ipd(struct ehca_shca *shca, int port,
 	return 0;
 }
 
-struct ib_ah *ehca_create_ah(struct ib_pd *pd, struct ib_ah_attr *ah_attr)
+struct ib_ah *ehca_create_ah(struct ib_pd *pd, struct ib_ah_attr *ah_attr,
+			     struct ib_udata *udata)
 {
 	int ret;
 	struct ehca_av *av;
diff --git a/drivers/staging/rdma/ehca/ehca_iverbs.h b/drivers/staging/rdma/ehca/ehca_iverbs.h
index a995ecdc5c11..5e84397fd73f 100644
--- a/drivers/staging/rdma/ehca/ehca_iverbs.h
+++ b/drivers/staging/rdma/ehca/ehca_iverbs.h
@@ -70,7 +70,8 @@ struct ib_pd *ehca_alloc_pd(struct ib_device *device,
 
 int ehca_dealloc_pd(struct ib_pd *pd);
 
-struct ib_ah *ehca_create_ah(struct ib_pd *pd, struct ib_ah_attr *ah_attr);
+struct ib_ah *ehca_create_ah(struct ib_pd *pd, struct ib_ah_attr *ah_attr,
+			     struct ib_udata *udata);
 
 int ehca_modify_ah(struct ib_ah *ah, struct ib_ah_attr *ah_attr);
 
diff --git a/drivers/staging/rdma/ipath/ipath_verbs.c b/drivers/staging/rdma/ipath/ipath_verbs.c
index 53f9dcab180d..fd5beae7618b 100644
--- a/drivers/staging/rdma/ipath/ipath_verbs.c
+++ b/drivers/staging/rdma/ipath/ipath_verbs.c
@@ -1777,7 +1777,8 @@ static int ipath_dealloc_pd(struct ib_pd *ibpd)
  * This may be called from interrupt context.
  */
 static struct ib_ah *ipath_create_ah(struct ib_pd *pd,
-				     struct ib_ah_attr *ah_attr)
+				     struct ib_ah_attr *ah_attr,
+				     struct ib_udata *udata)
 {
 	struct ipath_ah *ah;
 	struct ib_ah *ret;
-- 
1.8.5.6

