From: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
Date: Mon, 13 Jun 2016 14:32:23 +0000
Subject: spi: orion: Fix return value check in orion_spi_probe()
Git-commit: 57c624ae1c0aa631f11768992a74998c531a7fee
Patch-mainline: v4.8-rc1
References: fate#319899 fate#320700

In case of error, the function devm_ioremap() returns NULL pointer
not ERR_PTR(). The IS_ERR() test in the return value check should
be replaced with NULL test.

Signed-off-by: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
Signed-off-by: Mark Brown <broonie@kernel.org>
Signed-off-by: Matthias Brugger <mbrugger@suse.com>
---
 drivers/spi/spi-orion.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/spi/spi-orion.c b/drivers/spi/spi-orion.c
index d0d9c86..ded3702 100644
--- a/drivers/spi/spi-orion.c
+++ b/drivers/spi/spi-orion.c
@@ -655,8 +655,8 @@ static int orion_spi_probe(struct platform_device *pdev)
 		spi->direct_access[cs].vaddr = devm_ioremap(&pdev->dev,
 							    r->start,
 							    PAGE_SIZE);
-		if (IS_ERR(spi->direct_access[cs].vaddr)) {
-			status = PTR_ERR(spi->direct_access[cs].vaddr);
+		if (!spi->direct_access[cs].vaddr) {
+			status = -ENOMEM;
 			goto out_rel_clk;
 		}
 		spi->direct_access[cs].size = PAGE_SIZE;
-- 
2.10.0

