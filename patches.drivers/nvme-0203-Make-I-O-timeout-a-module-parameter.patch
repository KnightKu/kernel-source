From: Keith Busch <keith.busch@intel.com>
Date: Fri, 4 Apr 2014 11:43:36 -0600
Subject: NVMe: Make I/O timeout a module parameter
References: bnc#913030,FATE#317455
Patch-Mainline: v3.16
Git-commit: b355084a891985d4cd0ca23b1a83366af2c4232d

Increase the default timeout to 30 seconds to match SCSI.

Signed-off-by: Keith Busch <keith.busch@intel.com>
[use byte instead of ushort]
Signed-off-by: Matthew Wilcox <matthew.r.wilcox@intel.com>

Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/block/nvme-core.c |    4 ++++
 include/linux/nvme.h      |    3 ++-
 2 files changed, 6 insertions(+), 1 deletion(-)

--- a/drivers/block/nvme-core.c
+++ b/drivers/block/nvme-core.c
@@ -50,6 +50,10 @@
 #define CQ_SIZE(depth)		(depth * sizeof(struct nvme_completion))
 #define ADMIN_TIMEOUT	(60 * HZ)
 
+unsigned char io_timeout = 30;
+module_param(io_timeout, byte, 0644);
+MODULE_PARM_DESC(io_timeout, "timeout in seconds for I/O");
+
 static int nvme_major;
 module_param(nvme_major, int, 0);
 
--- a/include/linux/nvme.h
+++ b/include/linux/nvme.h
@@ -532,7 +532,8 @@ struct nvme_admin_cmd {
 #include <linux/miscdevice.h>
 #include <linux/kref.h>
 
-#define NVME_IO_TIMEOUT	(5 * HZ)
+extern unsigned char io_timeout;
+#define NVME_IO_TIMEOUT	(io_timeout * HZ)
 
 /*
  * Represents an NVM Express device.  Each nvme_dev is a PCI function.
