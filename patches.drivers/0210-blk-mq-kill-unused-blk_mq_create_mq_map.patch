From: Jens Axboe <axboe@fb.com>
Date: Thu, 15 Sep 2016 08:45:45 -0600
Subject: blk-mq: kill unused blk_mq_create_mq_map()
Git-commit: 9151bcb4fb38aab04cdc67cc3b3e11396db1b8b4
References: FATE#322379,bsc#1020989
Patch-Mainline: v4.9-rc1

Fixes 1b157939f92a ("blk-mq: get rid of the cpumask in struct blk_mq_tags")
Signed-off-by: Jens Axboe <axboe@fb.com>

Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/blk-mq.c | 24 ------------------------
 1 file changed, 24 deletions(-)

diff --git a/block/blk-mq.c b/block/blk-mq.c
index a6c5e96..0999179 100644
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@ -2284,30 +2284,6 @@ static int blk_mq_alloc_rq_maps(struct blk_mq_tag_set *set)
 	return 0;
 }
 
-static int blk_mq_create_mq_map(struct blk_mq_tag_set *set,
-		const struct cpumask *affinity_mask)
-{
-	int queue = -1, cpu = 0;
-
-	set->mq_map = kzalloc_node(sizeof(*set->mq_map) * nr_cpu_ids,
-			GFP_KERNEL, set->numa_node);
-	if (!set->mq_map)
-		return -ENOMEM;
-
-	if (!affinity_mask)
-		return 0;	/* map all cpus to queue 0 */
-
-	/* If cpus are offline, map them to first hctx */
-	for_each_online_cpu(cpu) {
-		if (cpumask_test_cpu(cpu, affinity_mask))
-			queue++;
-		if (queue >= 0)
-			set->mq_map[cpu] = queue;
-	}
-
-	return 0;
-}
-
 /*
  * Alloc a tag set to be associated with one or more request queues.
  * May fail with EINVAL for various error conditions. May adjust the
-- 
1.8.5.6

