From d4d03f74a73f3b8b2801d4d02011b6b69778cbcc Mon Sep 17 00:00:00 2001
From: John Johansen <john.johansen@canonical.com>
Date: Sat, 9 Jul 2016 23:46:33 -0700
Subject: [PATCH] apparmor: fix arg_size computation for when setprocattr is null terminated
Patch-mainline: Queued in subsystem maintainer repository
Git-commit: d4d03f74a73f3b8b2801d4d02011b6b69778cbcc
Git-repo: git://git.kernel.org/pub/scm/linux/kernel/git/jmorris/linux-security.git
References: CVE-2016-6187,bsc#988307

Signed-off-by: John Johansen <john.johansen@canonical.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 security/apparmor/lsm.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/security/apparmor/lsm.c
+++ b/security/apparmor/lsm.c
@@ -530,7 +530,7 @@ static int apparmor_setprocattr(struct t
 	if (!*args)
 		goto out;
 
-	arg_size = size - (args - (char *) value);
+	arg_size = size - (args - (largs ? largs : (char *) value));
 	if (strcmp(name, "current") == 0) {
 		if (strcmp(command, "changehat") == 0) {
 			error = aa_setprocattr_changehat(args, arg_size,
