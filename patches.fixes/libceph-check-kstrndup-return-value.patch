From: Chengguang Xu <cgxu519@icloud.com>
Date: Fri, 26 Jan 2018 14:54:43 +0800
Subject: libceph: check kstrndup() return value
Git-commit: affff07739392920d3d2095212c72af220481b95
Patch-mainline: v4.16-rc1
References: bsc#1081735

Should check result of kstrndup() in case of memory allocation failure.

Signed-off-by: Chengguang Xu <cgxu519@icloud.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Acked-by: Luis Henriques <lhenriques@suse.com>
---
 net/ceph/ceph_common.c |    4 ++++
 1 file changed, 4 insertions(+)

--- a/net/ceph/ceph_common.c
+++ b/net/ceph/ceph_common.c
@@ -410,6 +410,10 @@ ceph_parse_options(char *options, const
 			opt->name = kstrndup(argstr[0].from,
 					      argstr[0].to-argstr[0].from,
 					      GFP_KERNEL);
+			if (!opt->name) {
+				err = -ENOMEM;
+				goto out;
+			}
 			break;
 		case Opt_secret:
 		        opt->key = kzalloc(sizeof(*opt->key), GFP_KERNEL);
