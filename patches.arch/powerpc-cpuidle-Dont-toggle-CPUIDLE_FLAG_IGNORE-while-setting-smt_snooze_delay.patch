From: Shilpasri G Bhat <shilpa.bhat@linux.vnet.ibm.com>
Date: Mon, 6 Feb 2017 03:23:27 +0530
Subject: powerpc,cpuidle: Dont toggle CPUIDLE_FLAG_IGNORE while setting smt_snooze_delay
Patch-mainline: Never, SLE11-SP4 specific
References: bsc#1023163

Signed-off-by: Shilpasri G Bhat <shilpa.bhat@linux.vnet.ibm.com>
Acked-by: Mike Galbraith <mgalbraith@suse.de>
---
 arch/powerpc/platforms/pseries/processor_idle.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/arch/powerpc/platforms/pseries/processor_idle.c
+++ b/arch/powerpc/platforms/pseries/processor_idle.c
@@ -168,7 +168,7 @@ void update_smt_snooze_delay(int cpu, in
 	} else {
 		dev = per_cpu_ptr(pseries_cpuidle_devices, cpu);
 		if (dev) {
-			dev->states[1].flags ^= CPUIDLE_FLAG_IGNORE;
+			dev->states[1].flags &= !CPUIDLE_FLAG_IGNORE;
 			dev->states[1].target_residency = residency;
 		}
 	}
