From 719a44ca4d4369f57ec0d1503696d12ca23bf67f Mon Sep 17 00:00:00 2001
From: Mian Yousaf Kaukab <yousaf.kaukab@suse.com>
Date: Fri, 5 Jan 2018 10:14:46 +0100
Subject: [PATCH 35/40] arm64: mm: hardcode rodata=true

Patch-mainline: Never, Fix for compilation errors
References: bsc#1068032

rodata_enabled is not available since [1] is not applied. [2] has
used a hardcoded value instead. Fix the compilation errors after
applying [3] by adding a local rodata_enabled variable with hardcoded
value and keep the code as is.

[1]: 39290b389ea2 module: extend 'rodata=off' boot cmdline parameter to module mappings
[2]: e78e92e6d9 arm64: mmu: map .text as read-only from the outset (bsc#1044339)
[3]: 51a0048beb44 arm64: mm: Map entry trampoline into trampoline and kernel page tables

Signed-off-by: Mian Yousaf Kaukab <yousaf.kaukab@suse.com>
---
 arch/arm64/mm/mmu.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/mm/mmu.c b/arch/arm64/mm/mmu.c
index a8ce9703c282..634fadab89a6 100644
--- a/arch/arm64/mm/mmu.c
+++ b/arch/arm64/mm/mmu.c
@@ -51,6 +51,9 @@ u64 idmap_t0sz = TCR_T0SZ(VA_BITS);
 u64 kimage_voffset __section(.hyp.text);
 EXPORT_SYMBOL(kimage_voffset);
 
+/* Hardcode rodata=true to fix compilation errors */
+static bool rodata_enabled = true;
+
 /*
  * Empty_zero_page is a special page that is used for zero-initialized data
  * and COW.
@@ -547,7 +550,7 @@ static void __init map_kernel(pgd_t *pgd)
 	 * mapping to install SW breakpoints. Allow this (only) when
 	 * explicitly requested with rodata=off.
 	 */
-	pgprot_t text_prot = true ? PAGE_KERNEL_ROX : PAGE_KERNEL_EXEC;
+	pgprot_t text_prot = rodata_enabled ? PAGE_KERNEL_ROX : PAGE_KERNEL_EXEC;
 
 	/*
 	 * Only rodata will be remapped with different permissions later on,
-- 
2.11.0

