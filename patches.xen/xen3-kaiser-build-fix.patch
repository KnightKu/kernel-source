From: bp@suse.de
Subject: temporary fix
Patch-mainline: never, hell no
References: bsc#1068032

---
 arch/x86/include/mach-xen/asm/system.h |    1 -
 arch/x86/kernel/cpu/spec_ctrl.c        |    2 ++
 2 files changed, 2 insertions(+), 1 deletion(-)

--- a/arch/x86/include/mach-xen/asm/system.h
+++ b/arch/x86/include/mach-xen/asm/system.h
@@ -554,7 +554,6 @@ void stop_this_cpu(void *dummy);
  */
 static __always_inline void rdtsc_barrier(void)
 {
-	alternative(ASM_NOP3, "mfence", X86_FEATURE_MFENCE_RDTSC);
 	alternative(ASM_NOP3, "lfence", X86_FEATURE_LFENCE_RDTSC);
 }
 
--- a/arch/x86/kernel/cpu/spec_ctrl.c
+++ b/arch/x86/kernel/cpu/spec_ctrl.c
@@ -47,7 +47,9 @@ EXPORT_SYMBOL_GPL(x86_enable_ibrs);
  */
 void stuff_RSB(void)
 {
+#ifndef CONFIG_XEN
 	stuff_rsb();
+#endif
 }
 EXPORT_SYMBOL_GPL(stuff_RSB);
 
