From: Lee Duncan <lduncan@suse.com>
Date: Thu Aug  6 10:45:55 PDT 2015
Subject: SCSI: kabi: allow iscsi disocvery session support
Reference: bsc#923002
Patch-mainline: Never: SUSE-Specific

This patch allows recent commits that allow
IB/iSER discovery support to pass kabi checks by
hiding a new enum and a new structure field from
the kabi checker, as well as moving the new
structure field to the end of the structure. 

Inspection of the code shows that there are only a few
places where the modified structure (iscsi_session) is
allocated: iscsi_session_setup() and
iscsi_login_zero_tsih_s1(), and those are in-kernel.
It is expected that external modules would use the
first one, so we should be safe here.

Signed-off-by: Lee Duncan <lduncan@suse.com>
--- 
 include/scsi/iscsi_if.h |    2 ++
 include/scsi/libiscsi.h |    5 ++++-
 2 files changed, 6 insertions(+), 1 deletion(-)

--- a/include/scsi/iscsi_if.h
+++ b/include/scsi/iscsi_if.h
@@ -490,7 +490,9 @@ enum iscsi_param {
 	ISCSI_PARAM_CHAP_IN_IDX,
 	ISCSI_PARAM_CHAP_OUT_IDX,
 
+#ifndef __GENKSYMS__
 	ISCSI_PARAM_DISCOVERY_SESS,
+#endif
 
 	/* must always be last */
 	ISCSI_PARAM_MAX,
--- a/include/scsi/libiscsi.h
+++ b/include/scsi/libiscsi.h
@@ -287,7 +287,6 @@ struct iscsi_session {
 	char			*targetalias;
 	char			*ifacename;
 	char			*initiatorname;
-	char			*discovery_sess;
 
 	/* control data */
 	struct iscsi_transport	*tt;
@@ -307,6 +306,10 @@ struct iscsi_session {
 	struct iscsi_task	**cmds;		/* Original Cmds arr */
 	struct iscsi_pool	cmdpool;	/* PDU's pool */
 	void			*dd_data;	/* LLD private data */
+#ifndef __GENKSYMS__
+	/* move new field to end to minimize change */
+	uint8_t			discovery_sess;
+#endif
 };
 
 enum {
