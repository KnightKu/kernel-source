From c794ee5993bfac6cf7aa822a919857662ae4b988 Mon Sep 17 00:00:00 2001
From: Joerg Roedel <jroedel@suse.de>
Date: Tue, 13 Mar 2018 15:44:46 +0100
Subject: [PATCH 12/17] x86/kaiser: Don't user-map the VSYSCALL page on 32 bit
References: bsc#1068032 CVE-2017-5754
Patch-mainline: No, different upstream implementation

It doesn't exist on 32 bit, so don't try to map it.

Signed-off-by: Joerg Roedel <jroedel@suse.de>
---
 arch/x86/mm/kaiser.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/arch/x86/mm/kaiser.c b/arch/x86/mm/kaiser.c
index 3d27a05..a547ea9 100644
--- a/arch/x86/mm/kaiser.c
+++ b/arch/x86/mm/kaiser.c
@@ -364,10 +364,12 @@ void __init kaiser_init(void)
 	kaiser_add_user_map_early((void *)idt_descr.address,
 				  sizeof(gate_desc) * NR_VECTORS,
 				  __PAGE_KERNEL_RO);
+#ifdef CONFIG_X86_64
 	kaiser_add_user_map_early((void *)VVAR_ADDRESS, PAGE_SIZE,
 				  __PAGE_KERNEL_VVAR);
 	kaiser_add_user_map_early((void *)VSYSCALL_START, PAGE_SIZE,
 				  vsyscall_pgprot);
+#endif
 }
 
 /* Add a mapping to the shadow mapping, and synchronize the mappings */
-- 
1.8.5.6

