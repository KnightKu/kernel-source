From: K. Y. Srinivasan <kys@microsoft.com>
Date: Thu, 6 Oct 2011 10:10:56 -0700
Patch-mainline: v3.2-rc1
Subject: [PATCH] Staging: hv: netvsc: Fix a dereferencing issue
Git-commit: 715a4801e734ea9c8e528265ce3ff6aead85bce1

net_dev is being de-referenced without proper checking; fix it.

Signed-off-by: K. Y. Srinivasan <kys@microsoft.com>
Signed-off-by: Haiyang Zhang <haiyangz@microsoft.com>
Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
---
 drivers/staging/hv/rndis_filter.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/staging/hv/rndis_filter.c
+++ b/drivers/staging/hv/rndis_filter.c
@@ -368,11 +368,11 @@ int rndis_filter_receive(struct hv_devic
 	struct rndis_message *rndis_hdr;
 	struct net_device *ndev;
 
-	ndev = net_dev->ndev;
-
 	if (!net_dev)
 		return -EINVAL;
 
+	ndev = net_dev->ndev;
+
 	/* Make sure the rndis device state is initialized */
 	if (!net_dev->extension) {
 		netdev_err(ndev, "got rndis message but no rndis device - "
