From: Jiri Slaby <jslaby@suse.cz>
Date: Thu, 14 Jan 2016 16:49:31 +0100
Subject: kgr: mark task_safe in non-upstream kthreads
Patch-mainline: not yet, kgraft
References: fate#313296

Some kthreads were removed post-4.4. This patch serves them.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 fs/notify/mark.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/fs/notify/mark.c
+++ b/fs/notify/mark.c
@@ -511,7 +511,9 @@ static int fsnotify_mark_destroy(void *i
 			fsnotify_put_mark(mark);
 		}
 
-		wait_event_interruptible(destroy_waitq, !list_empty(&destroy_list));
+		wait_event_interruptible(destroy_waitq, ({
+				klp_kgraft_mark_task_safe(current);
+				!list_empty(&destroy_list); }));
 	}
 
 	return 0;
