From: Elena Reshetova <elena.reshetova@intel.com>
Date: Mon, 4 Sep 2017 13:11:56 +0300
Subject: udf: prevent speculative execution
Patch-mainline: submitted on 2018/1/9
References: bnc#1068032

Real commit text tbd

Signed-off-by: Elena Reshetova <elena.reshetova@intel.com>
Signed-off-by: Tim Chen <tim.c.chen@linux.intel.com>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 fs/udf/misc.c |    6 ++++++
 1 file changed, 6 insertions(+)

--- a/fs/udf/misc.c
+++ b/fs/udf/misc.c
@@ -25,6 +25,7 @@
 #include <linux/string.h>
 #include <linux/buffer_head.h>
 #include <linux/crc-itu-t.h>
+#include <linux/system.h>
 
 #include "udf_i.h"
 #include "udf_sb.h"
@@ -105,6 +106,8 @@
 					iinfo->i_lenEAttr) {
 				uint32_t aal =
 					le32_to_cpu(eahd->appAttrLocation);
+
+				gmb();
 				memmove(&ea[offset - aal + size],
 					&ea[aal], offset - aal);
 				offset -= aal;
@@ -115,6 +118,8 @@
 					iinfo->i_lenEAttr) {
 				uint32_t ial =
 					le32_to_cpu(eahd->impAttrLocation);
+
+				gmb();
 				memmove(&ea[offset - ial + size],
 					&ea[ial], offset - ial);
 				offset -= ial;
@@ -126,6 +131,8 @@
 					iinfo->i_lenEAttr) {
 				uint32_t aal =
 					le32_to_cpu(eahd->appAttrLocation);
+
+				gmb();
 				memmove(&ea[offset - aal + size],
 					&ea[aal], offset - aal);
 				offset -= aal;
