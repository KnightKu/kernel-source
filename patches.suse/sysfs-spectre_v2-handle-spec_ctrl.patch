From: Jiri Slaby <jslaby@suse.cz>
Subject: sysfs: spectre_v2, handle spec_ctrl
Patch-mainline: never, SUSE specific
References: bsc#1075994 bsc#1075091

/sys/devices/system/cpu/vulnerabilities/spectre_v2 does no take into
account that we have IBRS+IBPB in our tree. Fix that.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 arch/x86/kernel/cpu/bugs.c |    4 ++++
 1 file changed, 4 insertions(+)

--- a/arch/x86/kernel/cpu/bugs.c
+++ b/arch/x86/kernel/cpu/bugs.c
@@ -439,6 +439,10 @@ ssize_t cpu_show_spectre_v2(struct devic
 {
 	if (!x86_bug_spectre_v2)
 		return sprintf(buf, "Not affected\n");
+
+	if (boot_cpu_has(X86_FEATURE_SPEC_CTRL))
+		return sprintf(buf, "Mitigation: IBRS+IBPB\n");
+
 	return sprintf(buf, "Vulnerable\n");
 }
 #endif
