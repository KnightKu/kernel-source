From: Greg Kroah-Hartman <gregkh@suse.de>
Date: Tue, 11 Oct 2011 09:20:31 -0600
Patch-mainline: v3.2-rc1
Subject: [PATCH] Staging: hv: storvsc: remove last usage of DPRINT_WARN
Git-commit: d181daa06dd72fa88652b1d8bf723570a9fc55ea

Used the correct dev_warn() call instead.

Cc: K. Y. Srinivasan <kys@microsoft.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
---
 drivers/staging/hv/storvsc_drv.c |   16 ++++++++--------
 include/linux/hyperv.h           |    6 ------
 2 files changed, 8 insertions(+), 14 deletions(-)

diff --git a/drivers/staging/hv/storvsc_drv.c b/drivers/staging/hv/storvsc_drv.c
index af185ab..1f9d23e 100644
--- a/drivers/staging/hv/storvsc_drv.c
+++ b/drivers/staging/hv/storvsc_drv.c
@@ -510,20 +510,20 @@ static void storvsc_on_io_completion(struct hv_device *device,
 
 	if (vstor_packet->vm_srb.scsi_status != 0 ||
 		vstor_packet->vm_srb.srb_status != 1){
-		DPRINT_WARN(STORVSC,
-			    "cmd 0x%x scsi status 0x%x srb status 0x%x\n",
-			    stor_pkt->vm_srb.cdb[0],
-			    vstor_packet->vm_srb.scsi_status,
-			    vstor_packet->vm_srb.srb_status);
+		dev_warn(&device->device,
+			 "cmd 0x%x scsi status 0x%x srb status 0x%x\n",
+			 stor_pkt->vm_srb.cdb[0],
+			 vstor_packet->vm_srb.scsi_status,
+			 vstor_packet->vm_srb.srb_status);
 	}
 
 	if ((vstor_packet->vm_srb.scsi_status & 0xFF) == 0x02) {
 		/* CHECK_CONDITION */
 		if (vstor_packet->vm_srb.srb_status & 0x80) {
 			/* autosense data available */
-			DPRINT_WARN(STORVSC, "storvsc pkt %p autosense data "
-				    "valid - len %d\n", request,
-				    vstor_packet->vm_srb.sense_info_length);
+			dev_warn(&device->device,
+				 "storvsc pkt %p autosense data valid - len %d\n",
+				 request, vstor_packet->vm_srb.sense_info_length);
 
 			memcpy(request->sense_buffer,
 			       vstor_packet->vm_srb.sense_data,
diff --git a/include/linux/hyperv.h b/include/linux/hyperv.h
index 2229073..097d6db 100644
--- a/include/linux/hyperv.h
+++ b/include/linux/hyperv.h
@@ -721,7 +721,6 @@ extern void vmbus_ontimer(unsigned long data);
 							BLKVSC_DRV)
 
 /* Logging Level */
-#define WARNING_LVL				4
 #define INFO_LVL				6
 #define DEBUG_RING_LVL				9
 
@@ -733,11 +732,6 @@ extern unsigned int vmbus_loglevel;
 		printk(KERN_DEBUG #mod": %s() " fmt "\n", __func__, ## args);\
 	} while (0)
 
-#define DPRINT_WARN(mod, fmt, args...) do {\
-	if ((mod & (HIWORD(vmbus_loglevel))) &&		\
-	    (WARNING_LVL <= LOWORD(vmbus_loglevel)))	\
-		printk(KERN_WARNING #mod": WARNING! " fmt "\n", ## args);\
-	} while (0)
 
 struct hv_driver;
 struct hv_device;
-- 
1.6.0.2


